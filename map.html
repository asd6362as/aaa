<!DOCTYPE html>
<html lang="zh-tw">
  <title>MAP</title>
  <head>
    <meta charset="utf-8" />
    <style type="text/css" media="screen">
      html {
        position: absolute;
        height: 100%;
        width: 100%;
      }
      #map {
        position: absolute;
        left: 0;
        height: 92%;
        width: 100vw;
      }
      #body {
        height: 90%;
        width: 100vw;
        position: absolute;
        top: 0;
        left: 0;
      }
    </style>
  </head>

  <body>
    <div class="body">
      <div id="map"></div>
    </div>
    <script
      type="text/javascript"
      src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"
    ></script>

    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDX5leokofv0p2FpjEO8XZeB6N7TxV-pnk&callback=initMap"
    ></script>

    <script type="text/javascript">
    var strUrl = location.search ;
    var getPara, ParaVal;
    var aryPara = [];
    var marker1;
    var map ;
    var markers = [];
    var cbstr = {};
    var name , email , phone , email1 = [];
      function initMap() {
        var marker;
        var latlng = { lat: 24.990229, lng: 121.232133 };
        map = new google.maps.Map(document.getElementById("map"), {
          zoom: 15,
          scaleControl: true,
          streetViewControl: false,
          clickableIcons: true,
        });
      if (strUrl.indexOf("?") != -1) {
        var getSearch = strUrl.split("?");
        getPara = getSearch[1].split("&");
        for (i = 0; i < getPara.length; i++) {
          ParaVal = getPara[i].split("=");
          aryPara.push(ParaVal[1]);
        }
        email1 = aryPara[1].split("%40");
        let emailstr = email1[0]+'@'+email1[1];
        name = decodeURI(aryPara[0]);
        email = emailstr;
        phone = aryPara[2]
      }
        setInterval(displayLocation, 1000);
        function displayLocation() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
              var lat = position.coords.latitude,
                lng = position.coords.longitude;
              var position1 = new google.maps.LatLng(
                position.coords.latitude,
                position.coords.longitude
              );
              if (marker && marker.setMap) {
                marker.setMap(null);
              }
              marker = new google.maps.Marker({
                position: position1,
                icon: "https://asd6362as.github.io/aaa/me.png",
                map: map,
              });
              map.setCenter(position1);
            });
            marker.setmap(map2);
          }
        }
        carbooma();
      function carbooma() {
          var xhr = new XMLHttpRequest();
          xhr.open("get", "https://asd6362as.github.io/aaa/car.json", true);
          xhr.send(null);
          xhr.onload = function () {
            var record = JSON.parse(xhr.responseText);
            carData = record.result.records;
            len = carData.length;
            for (i = 0; i < carData.length; i++) {

              var place = {};
              place.lat = parseFloat(carData[i]["lat"]);
              place.lng = parseFloat(carData[i]["lon"]);
              cbstr.map = map;
              cbstr.position = place;
              cbstr.icon = "https://asd6362as.github.io/aaa/car1.png";
              cbstr.title = carData[i]["車禍"];
              console.log(cbstr);
              const carboom=new google.maps.Marker(cbstr);
              markers.push(carboom)
            }
            carboom.setmap(map1);
          };
        }
      }
      function cg1() {
        var cb = document.getElementById("cb1");
        if(cb.style["background-image"]=="url(\"https://asd6362as.github.io/aaa/carboom.png\")")
        {
          cb.style["background-image"]="url(https://asd6362as.github.io/aaa/Carboom2.png)";
          for (let i = 0; i < markers.length; i++) {
          markers[i].setMap(null)
          }
        }
        else if(cb.style["background-image"]!="url(\"https://asd6362as.github.io/aaa/carboom.png\")"){
        cb.style["background-image"]="url(https://asd6362as.github.io/aaa/carboom.png)";
          for (let i = 0; i < markers.length; i++) {
              markers[i].setMap(map)
          }
        }
      }
      function Dc() {
      alert(name);
      alert(email);
      alert(phone);
      }

    </script>

    <input
      id="cb1"
      type="button"
      value=""
      style="
        position: absolute;
        width: 44px;
        height: 44px;
        font-size: 10px;
        bottom: 10%;
        background-image:url(https://asd6362as.github.io/aaa/carboom.png);
      "
      onClick="cg1()"
    />
    <input
      id="EC1"
      type="button"
      value="緊急聯絡人"
      style="
        position: absolute;
        width: 100px;
        height: 30px;
        font-size: 18px;
        right: 2%;
        bottom:5px;
      "
      onClick="location.href='EC.html'"
    />
    <input
      id="email1"
      type="button"
      value="電子信箱"
      style="
        position: absolute;
        width: 100px;
        height: 30px;
        font-size: 18px;
        right: 36.5%;
        bottom:5px;
      "
      onClick="location.href='EC.html'"
    />
    <input
      id="phone1"
      type="button"
      value="手機簡訊"
      style="
        position: absolute;
        width: 100px;
        height: 30px;
        font-size: 18px;
        right: 71%;
        bottom:5px;
      "
      onClick="Dc()"
    />


  </body>
</html>
